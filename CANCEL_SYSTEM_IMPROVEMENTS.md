# ุชุญุณููุงุช ูุธุงู ุงูุฅูุบุงุก - ุฅุตูุงุญ ุดุงูู

## ๐จ ุงููุดููุฉ ุงูุฃุตููุฉ
ูุงู ุฃูุฑ `/cancel` ูุง ูุนูู ุจุดูู ุตุญูุญ ุนูุฏูุง ูุฑุณูู ุงููุณุชุฎุฏูุ ููู ููู ููุงู ุนูุฏุฉ ุณูููุฉ ุฅูู ููุทุฉ ุงูุจุฏุงูุฉ.

## โ ุงูุญููู ุงููููุฐุฉ

### 1. **ุฅุถุงูุฉ ุฏุนู ุฃูุฑ `/cancel` ูู ุฌููุน ูุนุงูุฌุงุช ุงููุญุงุฏุซุฉ**

#### ุงููุดููุฉ:
- ูุนุงูุฌุงุช ุงููุญุงุฏุซุฉ ูุงูุช ุชุฏุนู ููุท `CallbackQueryHandler` ููุฅูุบุงุก (ุงูุฃุฒุฑุงุฑ)
- ูู ุชูู ุชุฏุนู `CommandHandler` ูุฃูุฑ `/cancel` ุงูููุชูุจ

#### ุงูุญู:
```python
fallbacks=[
    CallbackQueryHandler(cancel_operation, pattern='^cancel$'),    # ููุฃุฒุฑุงุฑ
    CommandHandler('cancel', cancel_operation),                   # ูุฃูุฑ /cancel
    MessageHandler(filters.Regex(r'^/cancel$'), cancel_operation), # ููุฑุณุงุฆู ุงููุตูุฉ
]
```

#### ุงููููุงุช ุงููุญุฏุซุฉ:
- โ `Telegram/report_mass.py`
- โ `Telegram/report_peer.py` 
- โ `Telegram/report_message.py`
- โ `Telegram/report_photo.py`
- โ `Telegram/report_sponsored.py`
- โ `Telegram/support_module.py` (ูุงู ูุญุฏุซ ูุณุจูุงู)

### 2. **ุชุญุณูู ุฏุงูุฉ ุงูุฅูุบุงุก `cancel_operation`**

#### ุงูุชุญุณููุงุช ุงูุฌุฏูุฏุฉ:

**ุฃ. ุฅุดุนุงุฑ ููุฑู ูููุณุชุฎุฏู:**
```python
# ุฅุนูุงู ุงููุณุชุฎุฏู ููุฑุงู ุจุงูุฅูุบุงุก
cancel_msg = await query.message.edit_text("๐ ุฌุงุฑู ุฅููุงู ุงูุนูููุฉ...")
await query.answer("๐ ุฌุงุฑู ุงูุฅูุบุงุก...")
```

**ุจ. ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุฅูุบุงุก:**
```python
# ุชุชุจุน ุนุฏุฏ ุงูููุงู ุงูููุบุงุฉ
cancelled_tasks = 0
total_tasks = len(tasks)
logger.info(f"๐ ูุญุงููุฉ ุฅูุบุงุก {total_tasks} ูููุฉ...")
```

**ุฌ. ุชูุธูู ุดุงูู ููุจูุงูุงุช:**
```python
keys_to_remove = [
    "tasks", "active", "lock", "failed_reports",
    "progress_message", "monitor_task", "accounts",
    "targets", "reason_obj", "method_type", "channel",
    "channel_title", "fetch_type", "fetch_limit", "days",
    "message", "reports_per_account", "cycle_delay",
    "proxies", "total_reports", "total_cycles", "current_cycle",
    "progress_success", "progress_confirmed", "progress_failed",
    "start_time", "detailed_stats"
]
```

**ุฏ. ุฑุณุงูุฉ ุฅูุบุงุก ุชูุตูููุฉ:**
```
๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ุจูุฌุงุญ

๐ ุฅุญุตุงุฆูุงุช ุงูุฅูุบุงุก:
โข ุงูููุงู ุงูููุบุงุฉ: 45/50
โข ุงูุจูุงูุงุช ุงูููุธูุฉ: 18 ุนูุตุฑ

๐ก ููููู ุงูุจุฏุก ูู ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู /start
```

### 3. **ุฏุนู ุงูุฅูุบุงุก ูู ุงููุธุงู ุงููุชุฒุงูู ุงูุฌุฏูุฏ**

#### ุงููุดููุฉ:
- ุงููุธุงู ุงูุฌุฏูุฏ ููุฅุจูุงุบ ุงููุชุฒุงูู ูู ููู ูุฏุนู ุงูุฅูุบุงุก ุจุดูู ุตุญูุญ
- ุงูููุงู ุงููุชุฒุงููุฉ ูุฏ ุชุณุชูุฑ ูู ุงูุนูู ุญุชู ูู ุชู ุฅูุบุงุก ุงูุนูููุฉ

#### ุงูุญู:
**ุฃ. ูุญุต ูุณุชูุฑ ูุนูุงูุฉ ุงูุฅูุบุงุก:**
```python
# ูุญุต ุงูุฅูุบุงุก ูุจู ุจุฏุก ูู ุฏูุฑุฉ
if not config.get("active", True):
    detailed_logger.info(f"๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ูุจู ุงูุฏูุฑุฉ {cycle + 1}")
    break

# ูุญุต ุงูุฅูุบุงุก ุฃุซูุงุก ุฅูุดุงุก ุงูููุงู
if not config.get("active", True):
    detailed_logger.info(f"๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ุฃุซูุงุก ุฅูุดุงุก ููุงู ุงูุฏูุฑุฉ {cycle + 1}")
    break
```

**ุจ. ุฅูุบุงุก ุงูููุงู ุงููุนููุฉ:**
```python
# ุฅุฐุง ุชู ุงูุฅูุบุงุกุ ุฃูุบู ุฌููุน ุงูููุงู ุงููุนููุฉ
if not config.get("active", True):
    detailed_logger.info(f"๐ ุฅูุบุงุก {len(cycle_tasks)} ูููุฉ ูุนููุฉ...")
    for task in cycle_tasks:
        if not task.done():
            task.cancel()
```

**ุฌ. ุงูุชุธุงุฑ ุฐูู ูุน ุฅููุงููุฉ ุงูุฅูุบุงุก:**
```python
# ุงูุชุธุงุฑ ูุน ูุญุต ุงูุฅูุบุงุก ูู ุซุงููุฉ
for wait_second in range(cycle_delay):
    if not config.get("active", True):
        detailed_logger.info(f"๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ุฃุซูุงุก ุงูุงูุชุธุงุฑ (ุซุงููุฉ {wait_second + 1}/{cycle_delay})")
        break
    await asyncio.sleep(1)
```

**ุฏ. ูุนุงูุฌุฉ ุงุณุชุซูุงุกุงุช ุงูุฅูุบุงุก:**
```python
try:
    cycle_results = await asyncio.gather(*cycle_tasks, return_exceptions=True)
except asyncio.CancelledError:
    detailed_logger.info(f"๐ ุชู ุฅูุบุงุก ููุงู ุงูุฏูุฑุฉ {cycle + 1}")
    break
```

### 4. **ุชุญุณูู ูุนุงูุฌุฉ ุงูููุงู ุงููุฑุฏูุฉ**

#### ูุญุต ุงูุฅูุบุงุก ูู ูู ูุฑุญูุฉ:
```python
# ูุญุต ุงูุฅูุบุงุก ูู ุจุฏุงูุฉ ุงููููุฉ
if not config.get("active", True):
    return {"success": False, "error": "ุชู ุฅูุบุงุก ุงูุนูููุฉ", "cancelled": True}

# ูุญุต ุงูุฅูุบุงุก ูุจู ุงูุงุชุตุงู
if not config.get("active", True):
    return {"success": False, "error": "ุชู ุฅูุบุงุก ุงูุนูููุฉ ูุจู ุงูุงุชุตุงู", "cancelled": True}

# ูุญุต ุงูุฅูุบุงุก ูุจู ุชูููุฐ ุงูุจูุงุบ
if not config.get("active", True):
    return {"success": False, "error": "ุชู ุฅูุบุงุก ุงูุนูููุฉ ูุจู ุงูุฅุจูุงุบ", "cancelled": True}
```

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

### โ **ุงูุขู ูุนูู ุฃูุฑ `/cancel` ูู:**
1. **ุฌููุน ูุฑุงุญู ุงูุฅุจูุงุบ ุงูุฌูุงุนู**:
   - โ ุงุฎุชูุงุฑ ุณุจุจ ุงูุฅุจูุงุบ
   - โ ุฅุฏุฎุงู ุฑุงุจุท ุงูููุงุฉ  
   - โ ุงุฎุชูุงุฑ ุงูููุดูุฑุงุช
   - โ ุฅุฏุฎุงู ุงูุชูุงุตูู
   - โ ุชุญุฏูุฏ ุนุฏุฏ ุงูุจูุงุบุงุช
   - โ ุฃุซูุงุก ุชูููุฐ ุงูุนูููุฉ

2. **ุฌููุน ุฃููุงุน ุงูุฅุจูุงุบ**:
   - โ ุงูุฅุจูุงุบ ุงูุฌูุงุนู (Mass Report)
   - โ ุฅุจูุงุบ ุงูุญุณุงุจุงุช (Peer Report)
   - โ ุฅุจูุงุบ ุงูุฑุณุงุฆู (Message Report)
   - โ ุฅุจูุงุบ ุงูุตูุฑ (Photo Report)
   - โ ุงูุฅุจูุงุบ ุนูู ุงูุฅุนูุงูุงุช (Sponsored Report)

3. **ุฌููุน ุฃููุงุน ุงูุฃูุงูุฑ**:
   - โ ุงูุถุบุท ุนูู ุฒุฑ "ุฅูุบุงุก โ"
   - โ ูุชุงุจุฉ `/cancel`
   - โ ุฅุฑุณุงู `/cancel` ูุฑุณุงูุฉ

### โก **ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ**
- **ุงูุฅูุบุงุก ุงูููุฑู**: ูุชููู ุงููุดุงุท ุฎูุงู ุซูุงูู ููููุฉ
- **ุฑุณุงุฆู ุชูุงุนููุฉ**: ุฅุดุนุงุฑ ููุฑู ูููุณุชุฎุฏู
- **ุชูุธูู ุฐูู**: ุฅุฒุงูุฉ ุฌููุน ุงูุจูุงูุงุช ุงููุคูุชุฉ

### ๐ **ูุนูููุงุช ููุตูุฉ**
- **ุฅุญุตุงุฆูุงุช ุงูุฅูุบุงุก**: ุนุฏุฏ ุงูููุงู ุงูููุบุงุฉ
- **ุชุชุจุน ุดุงูู**: ุชุณุฌูู ููุตู ูู ุงูุณุฌูุงุช
- **ุชูุงุฑูุฑ ูุงุถุญุฉ**: ุฑุณุงุฆู ูููููุฉ ูููุณุชุฎุฏู

## ๐ง **ููููุฉ ุงูุงุณุชุฎุฏุงู**

### **ุทุฑู ุงูุฅูุบุงุก:**

#### 1. ุงุณุชุฎุฏุงู ุงูุฃุฒุฑุงุฑ:
```
๐ฑ ุงุถุบุท ุนูู ุฒุฑ "ุฅูุบุงุก โ" ูู ุฃู ูุฑุญูุฉ
```

#### 2. ุงุณุชุฎุฏุงู ุงูุฃูุฑ:
```
๐ฌ ุงูุชุจ: /cancel
```

#### 3. ุฃุซูุงุก ุงูุนูููุฉ:
```
โณ ุฃุซูุงุก ุชูููุฐ ุงูุฅุจูุงุบุงุชุ ุงูุชุจ: /cancel
   ุณูุชููู ุงููุธุงู ูููุบู ุฌููุน ุงูููุงู ุงูุฌุงุฑูุฉ
```

### **ูุง ูุญุฏุซ ุนูุฏ ุงูุฅูุบุงุก:**

1. **ุฅููุงู ููุฑู** ูุฌููุน ุงูุนูููุงุช ุงูุฌุงุฑูุฉ
2. **ุฅูุบุงุก ุงูููุงู** ุงููุนููุฉ ูุงูููุงู ุงูุฌุงุฑูุฉ  
3. **ุชูุธูู ุงูุจูุงูุงุช** ูุฅุฒุงูุฉ ุงููุนูููุงุช ุงููุคูุชุฉ
4. **ุนุฑุถ ุฅุญุตุงุฆูุงุช** ุงูุฅูุบุงุก ูููุณุชุฎุฏู
5. **ุงูุนูุฏุฉ ููุญุงูุฉ ุงูุทุจูุนูุฉ** ููุจุฏุก ูู ุฌุฏูุฏ

## ๐ **ูุซุงู ุนูู ุนูููุฉ ุงูุฅูุบุงุก**

### **ุฃุซูุงุก ุงูุฅุจูุงุบ ุงูุฌูุงุนู:**
```
๐ฏ ุงูุฅุจูุงุบ ุงูุฌูุงุนู ุงููุชุฒุงูู
[โโโโโโโโโโโโโโโโโโโโ] 40%

๐ ุงูุฏูุฑุฉ 2/3
๐ ุงูุฅุญุตุงุฆูุงุช:
โซ๏ธ ุงููุทููุจ: 150
โ ูุฌุญ: 60
โ ูุดู: 5

๐ค ุงููุณุชุฎุฏู ููุชุจ: /cancel
```

### **ุงููุชูุฌุฉ:**
```
๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ุจูุฌุงุญ

๐ ุฅุญุตุงุฆูุงุช ุงูุฅูุบุงุก:
โข ุงูููุงู ุงูููุบุงุฉ: 48/50
โข ุงูุจูุงูุงุช ุงูููุธูุฉ: 18 ุนูุตุฑ

๐ก ููููู ุงูุจุฏุก ูู ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู /start
```

## ๐ **ุชูุงุตูู ุชูููุฉ**

### **ุขููุฉ ุงูุฅูุบุงุก ุงููุญุณูุฉ:**

1. **ูุถุน ุนูุงูุฉ ุงูุฅูุบุงุก**: `user_data["active"] = False`
2. **ุฅูุบุงุก ุงูููุงู ุงููุชุฒุงููุฉ**: `task.cancel()` ููู ูููุฉ
3. **ุงูุชุธุงุฑ ุงูุชูุงู ุงูุฅูุบุงุก**: `await asyncio.sleep(0.5)`
4. **ุชูุธูู ุงูุจูุงูุงุช**: ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุคูุชุฉ
5. **ุฅุดุนุงุฑ ุงููุณุชุฎุฏู**: ุฑุณุงูุฉ ุชูุตูููุฉ ูุน ุงูุฅุญุตุงุฆูุงุช

### **ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก:**

```python
try:
    # ุนูููุฉ ุงูุฅูุบุงุก
    task.cancel()
    cancelled_tasks += 1
except Exception as e:
    logger.error(f"โ ุฎุทุฃ ูู ุฅูุบุงุก ุงููููุฉ: {e}")
```

### **ุงูุชุณุฌูู ุงูููุตู:**
```python
logger.info(f"๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ูููุณุชุฎุฏู {user_id} - ููุงู ููุบุงุฉ: {cancelled_tasks}")
detailed_logger.info(f"๐ ุชู ุฅูุบุงุก ุงูุนูููุฉ ุฃุซูุงุก ุงูุฏูุฑุฉ {cycle + 1}")
```

## ๐ **ุงูุฎูุงุตุฉ**

ุชู ุฅุตูุงุญ ูุธุงู ุงูุฅูุบุงุก ุจุดูู ุดุงูู ููุนูู ูู:
- โ **ุฌููุน ุงููุฑุงุญู** ูุงูุญุงูุงุช
- โ **ุฌููุน ุฃููุงุน ุงูุฅุจูุงุบ**  
- โ **ุงููุธุงู ุงููุชุฒุงูู ุงูุฌุฏูุฏ**
- โ **ุงูุฃูุธูุฉ ุงูุชูููุฏูุฉ**

ุงููุธุงู ุงูุขู:
- **ุณุฑูุน ุงูุงุณุชุฌุงุจุฉ** ููุฅูุบุงุก
- **ุขูู** ููุง ูุชุฑู ุจูุงูุงุช ูุนููุฉ
- **ูุงุถุญ** ูุน ุฑุณุงุฆู ูููููุฉ
- **ููุตู** ูุน ุฅุญุตุงุฆูุงุช ุฏูููุฉ

**ุฃูุฑ `/cancel` ูุนูู ุงูุขู ุจุดูู ูุซุงูู! ๐ฏ**